<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="ZXing for JS">

  <title>ZXing Barcdoe & Qrcode Decoding from camera</title>

  <!--link rel="stylesheet" rel="preload" as="style" onload="this.rel='stylesheet';this.onload=null"
    href="https://fonts.googleapis.com/css?family=Roboto:300,300italic,700,700italic"-->
  <!--link rel="stylesheet" rel="preload" as="style" onload="this.rel='stylesheet';this.onload=null"
    href="https://unpkg.com/normalize.css@8.0.0/normalize.css"-->
	  <script type="text/javascript" src="https://unpkg.com/@zxing/library@latest"></script>
  <link rel="stylesheet" rel="preload" as="style" onload="this.rel='stylesheet';this.onload=null"
    href="https://unpkg.com/milligram@1.3.0/dist/milligram.min.css">
	
	 <style type="text/css">
	h2, video, textarea, pre, footer{
	margin-left:auto;
	margin-right:auto;
	display: block;
	text-align: center;
	}

      textarea {
        width: 90%;
		max-width:1200px;
        box-sizing: border-box;
        border: 1px solid #E1E100;
        background: #F5FFFA;
		margin-top:10px;
		font-size: 1.5em;
      }
      .btns{
	      float:right;
      }
      </style>
</head>

<body>

  <main class="wrapper">

    <section class="container" id="demo-content">
      <h2 class="title">Scan 1D/2D Code from Camera</h2>

    
      <div>
        <video id="video" width="300" height="200" style="border: 1px solid gray"></video>
      </div>
	  
		<!--div>
        <a class="button" id="startButton">Start</a>
        <a class="button" id="resetButton">Reset</a>
      </div-->
	  
      <!--div id="sourceSelectPanel" style="display:none">
        <label for="sourceSelect">Change video source:</label>
        <select id="sourceSelect" style="max-width:400px">
        </select>
      </div-->
	<textarea  id="text" rows="8" cols=""></textarea>
    <div class="btns">
    	<input onclick="document.getElementById('text').value='';" value="CLEAR" type="button">
	  <input value="COPY" onclick="document.getElementById('text').focus();document.getElementById('text').select();document.execCommand('copy')" type="button">
	</div>
      <label>History Results:</label>
	  <ul id="result"></ul>
	  
      <!--pre><code id="result"></code></pre-->


    </section>

    <footer class="footer">
      <section class="container">
        <p>ZXing TypeScript Demo. Licensed under the <a target="_blank"
            href="https://github.com/zxing-js/library#license" title="MIT">MIT</a>.</p>
      </section>
    </footer>

  </main>


  <script type="text/javascript">
   // window.addEventListener('load', function () {
      let selectedDeviceId;
      const codeReader = new ZXing.BrowserMultiFormatReader()
      console.log('ZXing code reader initialized')
      codeReader.listVideoInputDevices()
        .then((videoInputDevices) => {    
          selectedDeviceId = videoInputDevices[0].deviceId
		  console.log(videoInputDevices)
          if (videoInputDevices.length >= 1) 
				selectedDeviceId = videoInputDevices[1].deviceId

        })
        .catch((err) => {
          console.error(err)
        })
		
		
		
		codeReader.decodeFromVideoDevice(selectedDeviceId, 'video', (result, err) => {
               
			  if (result) {
                //console.log(document.getElementById('text').value)		
					 
				if (document.getElementById('text').value != result.text )
				{
					var node = document.createElement('li');
					
					node.appendChild( document.createTextNode(result.text) );
					
					document.getElementById('result').insertBefore(node, document.getElementById('result').childNodes[0]);
				}
				
				document.getElementById('text').value = result.text;
				
              }
              if (err && !(err instanceof ZXing.NotFoundException)) {
                console.error(err)
                document.getElementById('result').textContent = err
              }
            })
          console.log(`Started continous decode from camera with id ${selectedDeviceId}`)
   // })
  </script>

</body>

</html>
